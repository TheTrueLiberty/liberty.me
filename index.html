<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Liberty — Professional Portfolio</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
    --bg:#0a0a0a;--card:rgba(18,18,28,0.82);--glass:rgba(28,28,28,0.45);
    --accent:#b91c3e;--accent-hover:#e0204b;--text:#ececf5;--text-light:#aaaaaa;--border:rgba(185,28,62,0.28);
}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--text);font-family:'Inter',sans-serif;overflow-x:hidden;line-height:1.5;font-weight:400;}
h1,h2,h3,h4,h5,h6,strong{font-weight:700;letter-spacing:-0.3px;}
#myVideo{position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-2;opacity:0.38;filter:brightness(0.45) contrast(1.25);}
@media (max-width:768px){#myVideo{opacity:0.22;}}

.container{max-width:1320px;margin:0 auto;padding:80px 20px 140px;}
@media (max-width:768px){.container{padding:60px 16px 120px;}}

.card{background:var(--card);backdrop-filter:blur(22px);-webkit-backdrop-filter:blur(22px);border:1px solid var(--border);border-radius:36px;padding:50px 30px;
    box-shadow:0 25px 70px rgba(0,0,0,0.6), 0 0 25px rgba(185,28,62,0.35);opacity:0;transform:translateY(70px);
    transition:all 1.4s cubic-bezier(0.23,1,0.32,1);}
@media (max-width:768px){.card{padding:40px 24px;border-radius:28px;}}
.card.show{opacity:1;transform:none;}

.hero{display:flex;align-items:center;gap:40px;flex-wrap:wrap;}
@media (max-width:992px){.hero{gap:32px;flex-direction:column;align-items:center;text-align:center;}}
.avatar{width:260px;height:260px;border-radius:32px;overflow:hidden;border:6px solid var(--accent);
    box-shadow:0 0 0 36px rgba(185,28,62,0.4);flex-shrink:0;}
@media (max-width:480px){.avatar{width:200px;height:200px;}}
.avatar img{width:100%;height:100%;object-fit:cover;}
.intro{flex:1;min-width:300px;}
h1{font-size:48px;line-height:1.1;margin-bottom:14px;color:#fff;}
@media (max-width:480px){h1{font-size:38px;}}
.subtitle{font-size:18px;margin-bottom:36px;color:var(--text-light);opacity:0.9;}
.stats{display:flex;gap:32px;flex-wrap:wrap;justify-content:center;margin:36px 0;}
.stat{font-size:32px;color:var(--accent);font-weight:800;}
.stat small{font-size:14px;margin-top:4px;color:var(--text-light);display:block;opacity:0.9;font-weight:500;}
.cta-wrapper{display:flex;flex-wrap:wrap;gap:16px;margin-top:36px;justify-content:center;align-items:center;}
.cta{padding:16px 36px;font-size:18px;border-radius:50px;background:var(--accent);color:#fff;
    box-shadow:0 16px 36px rgba(185,28,62,0.35);cursor:pointer;transition:0.45s;text-decoration:none;
    display:inline-block;min-width:220px;text-align:center;font-weight:600;}
.cta:hover{background:var(--accent-hover);transform:translateY(-6px);}

#music-player{
    position:fixed;bottom:20px;left:20px;right:20px;max-width:440px;margin:0 auto;left:50%;transform:translateX(-50%);
    background:rgba(20,20,35,0.96);backdrop-filter:blur(32px);-webkit-backdrop-filter:blur(32px);
    border:1px solid rgba(185,28,62,0.35);border-radius:28px;padding:16px 20px;
    display:flex;align-items:center;gap:16px;z-index:999;
    box-shadow:0 20px 50px rgba(0,0,0,0.7), 0 0 30px rgba(185,28,62,0.2);
    opacity:0;transform:translateX(-50%) translateY(40px) scale(0.94);
    transition:all 0.7s cubic-bezier(0.23,1,0.32,1);}
#music-player.visible{opacity:1;transform:translateX(-50%) translateY(0) scale(1);}
#play-pause-btn{width:60px;height:60px;background:var(--accent);border:none;border-radius:50%;
    display:flex;align-items:center;justify-content:center;flex-shrink:0;box-shadow:0 12px 30px rgba(185,28,62,0.5);}
#play-pause-btn:hover{background:var(--accent-hover);transform:scale(1.1);}
#play-pause-btn svg{width:26px;height:26px;fill:#fff;transition:all 0.3s;}
#music-player.playing #play-pause-btn{animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{box-shadow:0 12px 30px rgba(185,28,62,0.5);}50%{box-shadow:0 12px 45px rgba(185,28,62,0.8);}}
.track-info{flex:1;overflow:hidden;}
.track-title{font-size:16px;color:#fff;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.artist{font-size:13px;color:var(--text-light);opacity:0.9;margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.progress-container{position:absolute;bottom:0;left:0;width:100%;height:5px;background:rgba(0,0,0,0.4);cursor:pointer;
    opacity:0;transition:opacity 0.4s;border-radius:0 0 28px 28px;overflow:hidden;}
#music-player.playing .progress-container{opacity:1;}
.progress-fill{background:var(--accent);width:0;height:100%;transition:width 0.1s linear;}
.progress-knob{position:absolute;top:50%;left:0;transform:translate(-50%,-50%);width:14px;height:14px;
    background:#fff;border-radius:50%;opacity:0;box-shadow:0 0 20px rgba(185,28,62,0.9);transition:opacity 0.2s;}
.progress-container:hover .progress-knob{opacity:1;}

.lang-master{position:fixed;top:16px;left:16px;width:50px;height:50px;background:rgba(18,18,28,0.95);border:2px solid var(--accent);border-radius:50%;
    display:flex;align-items:center;justify-content:center;color:#fff;font-size:17px;font-weight:700;cursor:pointer;z-index:1001;
    box-shadow:0 8px 30px rgba(0,0,0,0.6);transition:all 0.3s;}
.lang-master:hover{transform:scale(1.08);border-color:var(--accent-hover);}
.lang-popup{position:fixed;top:76px;left:16px;z-index:1000;opacity:0;pointer-events:none;transition:all 0.4s;display:flex;flex-direction:column;gap:10px;}
.lang-popup.active{opacity:1;pointer-events:all;}
.lang-btn{width:48px;height:48px;background:rgba(18,18,28,0.95);border:2px solid var(--border);border-radius:50%;
    display:flex;align-items:center;justify-content:center;color:#fff;font-size:16px;cursor:pointer;transition:all 0.3s;
    box-shadow:0 6px 20px rgba(0,0,0,0.5);}
.lang-btn:hover{border-color:var(--accent);transform:scale(1.1);background:var(--accent);}

.services h2,.reviews-section h2{font-size:38px;margin:100px 0 50px;color:var(--accent);text-align:center;font-weight:800;}
@media (max-width:480px){.services h2,.reviews-section h2{font-size:32px;margin:80px 0 40px;}}
.service-list,.reviews-list{display:grid;gap:24px;grid-template-columns:1fr;}
@media (min-width:992px){.service-list{grid-template-columns:repeat(auto-fit,minmax(340px,1fr));}}
@media (min-width:768px){.reviews-list{grid-template-columns:repeat(auto-fit,minmax(340px,1fr));}}
.service,.review-card{background:var(--glass);backdrop-filter:blur(14px);border:1px solid var(--border);border-radius:20px;
    padding:28px;display:flex;flex-direction:column;gap:12px;transition:all 0.5s;opacity:0;transform:translateY(30px);}
.service.show,.review-card{opacity:1;transform:none;}
.service:hover,.review-card:hover{transform:translateY(-10px);border-color:var(--accent);}
.service strong{font-size:21px;color:var(--accent);font-weight:700;}
.service .desc{font-size:15px;color:var(--text-light);opacity:0.92;}
.service .price{font-size:19px;color:var(--accent);font-weight:700;align-self:flex-end;}
.review-header{display:flex;align-items:center;gap:16px;margin-bottom:12px;}
.review-avatar{width:48px;height:48px;border-radius:50%;object-fit:cover;border:2px solid var(--accent);}
.review-name{font-weight:700;color:#fff;font-size:17px;}
.review-date{font-size:13px;color:var(--text-light);opacity:0.7;margin-left:auto;}
.review-stars{color:#ffd700;margin-top:8px;font-size:20px;}
.review-text{font-size:16px;line-height:1.5;margin-top:8px;}

.modal{position:fixed;inset:0;background:rgba(0,0,0,0.96);display:flex;align-items:center;justify-content:center;
    opacity:0;pointer-events:none;transition:0.5s;z-index:1000;padding:20px;}
.modal.show{opacity:1;pointer-events:auto;}
.modal-content{background:var(--card);backdrop-filter:blur(24px);border:1px solid var(--border);padding:50px 30px;border-radius:28px;
    width:100%;max-width:540px;text-align:center;transform:scale(0.92);transition:0.5s;}
.modal.show .modal-content{transform:scale(1);}
.modal-content h3{color:var(--accent);font-size:34px;margin-bottom:28px;}
.contact-links a,.payment-methods > div,.google-btn{display:flex;align-items:center;gap:20px;background:rgba(185,28,62,0.08);border:1px solid rgba(185,28,62,0.2);
    border-radius:20px;padding:16px 20px;margin:14px 0;transition:all 0.4s;font-weight:600;font-size:18px;color:var(--text);text-decoration:none;cursor:pointer;}
.contact-links a:hover,.payment-methods > div:hover,.google-btn:hover{background:rgba(185,28,62,0.18);border-color:var(--accent);transform:translateY(-6px);}
.contact-links img,.payment-methods img{width:56px;height:56px;border-radius:50%;object-fit:contain;}
#closeModal,#closePayment,#closeReviewModal{background:var(--accent);color:#fff;border:none;padding:14px 36px;border-radius:50px;
    cursor:pointer;font-size:17px;margin-top:28px;transition:0.3s;font-weight:600;}
#closeModal:hover,#closePayment:hover,#closeReviewModal:hover{background:var(--accent-hover);transform:scale(1.06);}
#reviewText{width:100%;background:rgba(255,255,255,0.1);border:1px solid var(--border);border-radius:16px;padding:16px;color:#fff;font-size:16px;margin-top:20px;resize:vertical;}
</style>
</head>
<body>

<video autoplay muted loop playsinline id="myVideo"><source src="assets/фон.mp4" type="video/mp4"></video>
<audio id="background-music" loop preload="auto"><source src="assets/песня.mp3" type="audio/mpeg"></audio>

<div class="lang-master" id="langMaster">EN</div>
<div class="lang-popup" id="langPopup">
    <div class="lang-btn" data-lang="en">EN</div>
    <div class="lang-btn" data-lang="ru">RU</div>
</div>

<div class="container">
    <div class="card" id="mainCard">
        <div class="hero">
            <div class="avatar"><img src="assets/6ad1f8b10c7b2937f056040602fe6f0f.jpg" alt="Liberty"></div>
            <div class="intro">
                <h1 data-en="Welcome to my bio :P" data-ru="Ты попал в моё био :P">Welcome to my bio :P</h1>
                <div class="subtitle" data-en="Certified Cyber Security Analyst • Network Architect • Python Developer"
                     data-ru="Сертифицированный специалист в сфере кибербезопасности • Нетворкер • Python-дев">
                    Certified Cyber Security Analyst • Network Architect • Python Developer
                </div>
                <div class="stats">
                    <div class="stat">2+<small data-en="years experience" data-ru="года в деле">years experience</small></div>
                    <div class="stat">50+<small data-en="completed projects" data-ru="выполненных заказов">completed projects</small></div>
                </div>
                <div class="cta-wrapper">
                    <a href="javascript:void(0)" class="cta" id="contactBtn">
                        <span data-en="HIRE ME NOW" data-ru="ОФОРМИТЬ ЗАКАЗ">HIRE ME NOW</span>
                    </a>
                    <a href="javascript:void(0)" class="cta" id="paymentBtn">
                        <span data-en="You can pay with" data-ru="Оплата через">You can pay with</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="services">
            <h2 data-en="SERVICES THAT I OFFER" data-ru="Что может предложить мой шоп">SERVICES THAT I OFFER</h2>
            <div class="service-list">
                <div class="service"><div><strong data-en="[01] Logo / Banner creation" data-ru="[01] Создание баннеров и лого">[01] Logo / Banner creation</strong><div class="desc" data-en="High-quality branding & graphics" data-ru="Логотипы и баннеры премиум-качества">High-quality branding & graphics</div></div><div class="price">$10</div></div>
                <div class="service"><div><strong data-en="[02] Website Creation" data-ru="[02] Создание веб-сайта">[02] Website Creation</strong><div class="desc" data-en="Order your own website..." data-ru="Создам веб-сайт под ваш вкус и требования">Order your own website...</div></div><div class="price" data-en="Depends on your needs" data-ru="В зависимости от потребностей">Depends on your needs</div></div>
                <div class="service ru-only"><div><strong>[03] Python / Bot Development</strong><div class="desc">Какие-либо скрипты на Python / боты для Discord, Telegram</div></div><div class="price">Зависит от сложности</div></div>
                <div class="service en-only"><div><strong>[03] Livery Design</strong><div class="desc">Custom liveries and covers</div></div><div class="price">$5 Per one.</div></div>
                <div class="service en-only"><div><strong>[04] Server Network Architecture</strong><div class="desc">Full server setup & support</div></div><div class="price">$150/mo</div></div>
                <div class="service en-only"><div><strong>[05] Python / Bot Development</strong><div class="desc">Custom scripts & automation</div></div><div class="price">Depends on Difficulty</div></div>
            </div>
        </div>

        <div class="reviews-section">
            <h2 data-en="CLIENT REVIEWS" data-ru="ОТЗЫВЫ КЛИЕНТОВ">CLIENT REVIEWS</h2>
            <div id="reviewsList" class="reviews-list"></div>
            <div class="cta-wrapper" style="margin-top:50px;">
                <a href="javascript:void(0)" class="cta" id="leaveReviewBtn">
                    <span data-en="LEAVE A REVIEW" data-ru="ОСТАВИТЬ ОТЗЫВ">LEAVE A REVIEW</span>
                </a>
            </div>
        </div>
    </div>
</div>

<div id="music-player">
    <button id="play-pause-btn">
        <svg class="play" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        <svg class="pause" viewBox="0 0 24 24" style="display:none"><path d="M6 4h4v16H6zM14 4h4v16h-4z"/></svg>
    </button>
    <div class="track-info">
        <div class="track-title">Nice logo</div>
        <div class="artist">Exyl</div>
    </div>
    <div class="progress-container" id="progress-container">
        <div class="progress-fill"></div>
        <div class="progress-knob"></div>
    </div>
</div>

<!-- Модалки -->
<div id="contactModal" class="modal"><div class="modal-content">
    <h3 data-en="CONTACT" data-ru="КОНТАКТЫ">CONTACT</h3>
    <div class="contact-links">
        <a href="mailto:interpoldis@gmail.com"><img src="https://cdn.jsdelivr.net/npm/simple-icons@v13/icons/gmail.svg" alt="Gmail"> interpoldis@gmail.com</a>
        <a href="https://t.me/TheTrueLiberty" target="_blank"><img src="https://cdn.jsdelivr.net/npm/simple-icons@v13/icons/telegram.svg" alt="Telegram"> @TheTrueLiberty</a>
        <a href="https://discord.com/users/1084944590898937867" target="_blank"><img src="https://cdn.jsdelivr.net/npm/simple-icons@v13/icons/discord.svg" alt="Discord"> TheTrueLiberty</a>
    </div>
    <button id="closeModal"><span data-en="Close" data-ru="Закрыть">Close</span></button>
</div></div>

<div id="paymentModal" class="modal"><div class="modal-content">
    <h3 data-en="Payment Methods" data-ru="Способы оплаты">Payment Methods</h3>
    <div class="payment-methods">
        <div><img src="https://play-lh.googleusercontent.com/JBFEfcBlEhgL-QEP-Vw_drnPVLUcaxJQt_io9wxntkEJ-YBp1pXn3XQI1eiyzc-SQw=w240-h480-rw" alt="Tonkeeper"><strong>Tonkeeper</strong></div>
        <div><img src="https://trustwallet.com/assets/images/media/assets/TWT.png" alt="Trust Wallet"><strong>Trust Wallet</strong></div>
        <div><img src="https://logos.telegram-store.com/bots/cryptobot/telegram_bot_logo.jpg" alt="CryptoBot"><strong>@cryptobot</strong></div>
        <div><img src="https://img.freepik.com/premium-photo/three-stacked-bank-cards-dark-background_1219282-1018.jpg?w=740" alt="Bank Transfer">
            <strong data-en="European bank transfer" data-ru="Банковский перевод (EU)">European bank transfer</strong>
        </div>
    </div>
    <p style="margin-top:28px;opacity:0.85;font-size:16px;" data-en="DM me for wallet address" data-ru="Напиши мне — пришлю реквизиты">
        DM me for wallet address
    </p>
    <button id="closePayment"><span data-en="Close" data-ru="Закрыть">Close</span></button>
</div></div>

<div id="reviewModal" class="modal"><div class="modal-content">
    <h3 data-en="Leave your review" data-ru="Оставить отзыв">Leave your review</h3>
    <div id="googleSignInBtn" class="google-btn">Sign in with Google</div>
    <div id="reviewForm" style="display:none;">
        <textarea id="reviewText" data-en-placeholder="Write your review (up to 300 characters)..."
                  data-ru-placeholder="Напиши свой отзыв (до 300 символов)..." placeholder="Напиши свой отзыв (до 300 символов)..." maxlength="300" rows="5"></textarea>
        <div style="margin:20px 0;text-align:center;"><div id="ratingStars" style="font-size:32px;letter-spacing:8px;cursor:pointer;">★★★★★</div></div>
        <button id="submitReviewBtn" class="cta" style="width:100%;"><span data-en="Submit review" data-ru="Отправить отзыв">Отправить отзыв</span></button>
    </div>
    <button id="closeReviewModal"><span data-en="Close" data-ru="Закрыть">Close</span></button>
</div></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, doc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDwsbb_tGMjr-s3NXmkkh1iEXkxKr9fDIQ",
    authDomain: "liberty-bio.firebaseapp.com",
    projectId: "liberty-bio",
    storageBucket: "liberty-bio.firebasestorage.app",
    messagingSenderId: "498591653250",
    appId: "1:498591653250:web:e634097c5fe0034212839b",
    measurementId: "G-3W98LCQK1X"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const audio = document.getElementById('background-music');
  const player = document.getElementById('music-player');
  document.body.addEventListener('click', () => audio.play().catch(()=>{}), {once:true});
  setTimeout(() => player.classList.add('visible'), 1000);
  player.onclick = () => { audio.paused ? audio.play() && player.classList.add('playing') : audio.pause() && player.classList.remove('playing'); };
  audio.addEventListener('timeupdate', () => {
    const percent = (audio.currentTime / audio.duration) * 100 || 0;
    document.querySelector('.progress-fill').style.width = percent + '%';
    document.querySelector('.progress-knob').style.left = percent + '%';
  });
  document.getElementById('progress-container').onclick = e => {
    e.stopPropagation();
    const rect = e.currentTarget.getBoundingClientRect();
    audio.currentTime = ((e.clientX - rect.left) / rect.width) * audio.duration;
  };

  let currentLang = 'en';
  document.getElementById('langMaster').onclick = () => document.getElementById('langPopup').classList.toggle('active');
  document.querySelectorAll('.lang-btn').forEach(btn => btn.onclick = e => {
    e.stopPropagation();
    currentLang = btn.dataset.lang;
    document.getElementById('langMaster').textContent = currentLang.toUpperCase();
    document.querySelectorAll('[data-en],[data-ru]').forEach(el => el.dataset[currentLang] && (el.textContent = el.dataset[currentLang]));
    document.querySelectorAll('textarea[data-en-placeholder]').forEach(el => el.placeholder = el.dataset[currentLang === 'en' ? 'enPlaceholder' : 'ruPlaceholder']);
    document.querySelectorAll('.ru-only').forEach(el => el.style.display = currentLang==='ru'?'flex':'none');
    document.querySelectorAll('.en-only').forEach(el => el.style.display = currentLang==='en'?'flex':'none');
    document.getElementById('langPopup').classList.remove('active');
  });

  document.getElementById('contactBtn').onclick = () => document.getElementById('contactModal').classList.add('show');
  document.getElementById('paymentBtn').onclick = () => document.getElementById('paymentModal').classList.add('show');
  document.getElementById('leaveReviewBtn').onclick = () => document.getElementById('reviewModal').classList.add('show');
  document.getElementById('closeModal').onclick = () => document.getElementById('contactModal').classList.remove('show');
  document.getElementById('closePayment').onclick = () => document.getElementById('paymentModal').classList.remove('show');
  document.getElementById('closeReviewModal').onclick = () => document.getElementById('reviewModal').classList.remove('show');
  document.querySelectorAll('.modal').forEach(m => m.onclick = e => e.target===m && m.classList.remove('show'));
  document.addEventListener('keydown', e => e.key==='Escape' && document.querySelectorAll('.modal').forEach(m=>m.classList.remove('show')));

  setTimeout(() => document.getElementById('mainCard').classList.add('show'), 300);
  setTimeout(() => document.querySelectorAll('.service').forEach((s,i) => getComputedStyle(s).display!=='none' && setTimeout(()=>s.classList.add('show'),600+i*150)), 300);

  // ОТЗЫВЫ + АДМИНКА
  let currentUser = null;
  let currentRating = 5;
  const MY_UID = "EowDTxvpMhTcKhsV7x6kEpDAuyc2";

  const reviewsList = document.getElementById("reviewsList");
  const reviewsQuery = query(collection(db, "reviews"), orderBy("pinned", "desc"), orderBy("timestamp", "desc"));

  function renderReviews() {
    onSnapshot(reviewsQuery, snap => {
      reviewsList.innerHTML = "";
      snap.forEach(d => {
        const r = d.data();
        const isOwner = currentUser && currentUser.uid === MY_UID;
        const div = document.createElement("div");
        div.className = "review-card show";
        div.innerHTML = `
          <div class="review-header">
            <img src="${r.photoURL || 'https://via.placeholder.com/48'}" class="review-avatar">
            <div class="review-name">${r.name || (currentLang==='ru'?'Аноним':'Anonymous')}</div>
            ${r.pinned ? '<div style="color:#b91c3e;font-weight:900;margin-left:8px;">PINNED</div>' : ''}
            <div class="review-date">${r.timestamp?.toDate?.().toLocaleDateString(currentLang==='ru'?'ru-RU':'en-US') || ''}</div>
          </div>
          <div class="review-stars">${'★'.repeat(r.rating)}${'☆'.repeat(5-r.rating)}</div>
          <div class="review-text">${r.text.replace(/\n/g,'<br>')}</div>
          ${isOwner ? `<div style="margin-top:14px;display:flex;gap:10px;justify-content:flex-end;">
            <button class="pin-btn" data-id="${d.id}" style="background:${r.pinned?'#444':'rgba(185,28,62,0.3)'};padding:8px 14px;border-radius:8px;color:#fff;border:none;cursor:pointer;">
              ${r.pinned ? (currentLang==='ru'?'Открепить':'Unpin') : (currentLang==='ru'?'Закрепить':'Pin')}
            </button>
            <button class="delete-btn" data-id="${d.id}" style="background:#b91c3e;padding:8px 14px;border-radius:8px;color:#fff;border:none;cursor:pointer;">
              ${currentLang==='ru'?'Удалить':'Delete'}
            </button>
          </div>` : ''}
        `;
        reviewsList.appendChild(div);
      });

      if (currentUser && currentUser.uid === MY_UID) {
        document.querySelectorAll('.delete-btn').forEach(b => b.onclick = () => confirm(currentLang==='ru'?'Удалить навсегда?':'Delete forever?') && deleteDoc(doc(db, "reviews", b.dataset.id)));
        document.querySelectorAll('.pin-btn').forEach(b => b.onclick = async () => {
          const id = b.dataset.id;
          const wasPinned = b.textContent.includes(currentLang==='ru'?'Открепить':'Unpin');
          snap.docs.forEach(d => d.data().pinned && d.id !== id && updateDoc(doc(db, "reviews", d.id), {pinned:false}));
          await updateDoc(doc(db, "reviews", id), {pinned: !wasPinned});
        });
      }
    });
  }

  onAuthStateChanged(auth, user => { currentUser = user; renderReviews(); });

  document.getElementById("googleSignInBtn").onclick = async () => {
    const provider = new GoogleAuthProvider();
    const result = await signInWithPopup(auth, provider);
    currentUser = result.user;
    document.getElementById("googleSignInBtn").style.display = "none";
    document.getElementById("reviewForm").style.display = "block";
  };

  document.getElementById("ratingStars").addEventListener("click", e => {
    const rect = e.target.getBoundingClientRect();
    currentRating = Math.max(1, Math.min(5, Math.round((e.clientX - rect.left) / rect.width * 5)));
    e.target.innerHTML = '★'.repeat(currentRating) + '☆'.repeat(5-currentRating);
  });

  document.getElementById("submitReviewBtn").onclick = async () => {
    const text = document.getElementById("reviewText").value.trim();
    if (!text) return alert(currentLang==='ru'?'Напиши отзыв!':'Write a review!');
    if (!currentUser) return alert(currentLang==='ru'?'Войди через Google':'Sign in with Google');

    await addDoc(collection(db, "reviews"), {
      name: currentUser.displayName,
      photoURL: currentUser.photoURL,
      text, rating: currentRating, pinned: false, timestamp: serverTimestamp()
    });
    alert(currentLang==='ru'?'Спасибо за отзыв!':'Thank you!');
    document.getElementById("reviewModal").classList.remove("show");
    document.getElementById("reviewText").value = "";
    currentRating = 5;
    document.getElementById("ratingStars").innerHTML = '★★★★★';
  };
</script>
</body>
</html>
